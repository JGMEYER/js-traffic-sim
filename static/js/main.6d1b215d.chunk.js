(this["webpackJsonpjs-traffic-sim"]=this["webpackJsonpjs-traffic-sim"]||[]).push([[0],{20:function(e,t,i){},21:function(e,t,i){},22:function(e,t,i){},23:function(e,t,i){},24:function(e,t,i){},32:function(e,t,i){},33:function(e,t,i){"use strict";i.r(t);var r=i(0),n=i(2),s=i.n(n),a=i(13),o=i.n(a),c=(i(20),i(8)),h=i(4),u=(i(21),i(6)),l=i(5),d=i(1),v=i(3),f=(i(22),i(23),{UP:0,RIGHT:1,DOWN:2,LEFT:3});Object.freeze(f);var g=function(e){switch(parseInt(e)){case f.UP:return f.DOWN;case f.RIGHT:return f.LEFT;case f.DOWN:return f.UP;case f.LEFT:return f.RIGHT;default:throw new Error("Unknown direction provided")}},p={EMPTY:0,ALONE:1,UP:2,RIGHT:3,DOWN:4,LEFT:5,UP_RIGHT:6,RIGHT_DOWN:7,DOWN_LEFT:8,UP_LEFT:9,UP_DOWN:10,RIGHT_LEFT:11,UP_RIGHT_DOWN:12,RIGHT_DOWN_LEFT:13,UP_DOWN_LEFT:14,UP_RIGHT_LEFT:15,UP_RIGHT_DOWN_LEFT:16};function y(e){switch(e){case p.EMPTY:case p.ALONE:return[];case p.UP:return[f.UP];case p.RIGHT:return[f.RIGHT];case p.DOWN:return[f.DOWN];case p.LEFT:return[f.LEFT];case p.UP_RIGHT:return[f.UP,f.RIGHT];case p.RIGHT_DOWN:return[f.RIGHT,f.DOWN];case p.DOWN_LEFT:return[f.DOWN,f.LEFT];case p.UP_LEFT:return[f.UP,f.LEFT];case p.UP_DOWN:return[f.UP,f.DOWN];case p.RIGHT_LEFT:return[f.RIGHT,f.LEFT];case p.UP_RIGHT_DOWN:return[f.UP,f.RIGHT,f.DOWN];case p.RIGHT_DOWN_LEFT:return[f.RIGHT,f.DOWN,f.LEFT];case p.UP_DOWN_LEFT:return[f.UP,f.DOWN,f.LEFT];case p.UP_RIGHT_LEFT:return[f.UP,f.RIGHT,f.LEFT];case p.UP_RIGHT_DOWN_LEFT:return[f.UP,f.RIGHT,f.DOWN,f.LEFT];default:throw Error("Invalid road tile type")}}function T(e){return Object(r.jsxs)("div",{children:[Object(r.jsx)("p",{className:"road-tile-descriptor",children:e.displayRoadTileDescriptor?e.type:""}),Object(r.jsx)("div",{className:"road-tile road-tile".concat(e.type)})]})}Object.freeze(p);var O=function(){function e(t,i,r){if(Object(d.a)(this,e),!r){r=new Array(t);for(var n=0;n<t;n++)r[n]=new Array(i);for(var s=0;s<t;s++)for(var a=0;a<i;a++)r[s][a]=p.EMPTY}this.rows=t,this.cols=i,this.innerArray=r}return Object(v.a)(e,[{key:"get",value:function(e,t){return this.innerArray[e][t]}},{key:"getNeighbors",value:function(e,t){var i={};return e-1>=0&&this.innerArray[e-1][t]!==p.EMPTY&&(i[f.UP]={coords:[e-1,t],type:this.innerArray[e-1][t]}),t+1<this.cols&&this.innerArray[e][t+1]!==p.EMPTY&&(i[f.RIGHT]={coords:[e,t+1],type:this.innerArray[e][t+1]}),e+1<this.rows&&this.innerArray[e+1][t]!==p.EMPTY&&(i[f.DOWN]={coords:[e+1,t],type:this.innerArray[e+1][t]}),t-1>=0&&this.innerArray[e][t-1]!==p.EMPTY&&(i[f.LEFT]={coords:[e,t-1],type:this.innerArray[e][t-1]}),i}},{key:"hasNeighbors",value:function(e,t){return Object.keys(this.getNeighbors(e,t)).length>0}},{key:"evaluateRoadTileType",value:function(e,t,i){if(!i&&this.innerArray[e][t]===p.EMPTY)return p.EMPTY;var r=this.getNeighbors(e,t),n=Object.keys(r).length,s="undefined"!==typeof r[f.UP],a="undefined"!==typeof r[f.RIGHT],o="undefined"!==typeof r[f.DOWN],c="undefined"!==typeof r[f.LEFT];if(0===n)return p.ALONE;if(1===n){if(s)return p.UP;if(a)return p.RIGHT;if(o)return p.DOWN;if(c)return p.LEFT}else if(2===n){if(s&&a)return p.UP_RIGHT;if(a&&o)return p.RIGHT_DOWN;if(o&&c)return p.DOWN_LEFT;if(s&&c)return p.UP_LEFT;if(s&&o)return p.UP_DOWN;if(a&&c)return p.RIGHT_LEFT}else if(3===n){if(s&&a&&o)return p.UP_RIGHT_DOWN;if(a&&o&&c)return p.RIGHT_DOWN_LEFT;if(s&&o&&c)return p.UP_DOWN_LEFT;if(s&&a&&c)return p.UP_RIGHT_LEFT}else if(4===n)return p.UP_RIGHT_DOWN_LEFT}},{key:"updateTile",value:function(e,t,i){this.innerArray[e][t]=this.evaluateRoadTileType(e,t,i)}},{key:"_updateNeighbors",value:function(e,t,i){e-1>=0&&this.updateTile(e-1,t,i),t+1<this.cols&&this.updateTile(e,t+1,i),e+1<this.rows&&this.updateTile(e+1,t,i),t-1>=0&&this.updateTile(e,t-1,i)}},{key:"addTile",value:function(e,t,i){return this.innerArray[e][t]===p.EMPTY&&(!(i&&!this.hasNeighbors(e,t))&&(this.updateTile(e,t,!0),this._updateNeighbors(e,t,!1),!0))}},{key:"tileCanBeRemoved",value:function(e,t){return this.innerArray[e][t]!==p.EMPTY}},{key:"removeTile",value:function(e,t){this.innerArray[e][t]=p.EMPTY,this._updateNeighbors(e,t,!1)}}]),e}(),b=function(e){Object(u.a)(i,e);var t=Object(l.a)(i);function i(){return Object(d.a)(this,i),t.apply(this,arguments)}return Object(v.a)(i,[{key:"mouseDownHandler",value:function(e,t,i){switch(e.preventDefault(),e.buttons){case 1:this.props.addRoad(t,i,!1);break;case 2:this.props.removeRoad(t,i)}}},{key:"mouseOverHandler",value:function(e,t,i){switch(e.buttons){case 1:this.props.addRoad(t,i,!1);break;case 2:this.props.removeRoad(t,i)}}},{key:"render",value:function(){for(var e=this,t=this.props.globalSettings,i=this.props.roadTileMatrix,n=i.rows,s=i.cols,a=[],o=function(n){for(var o=function(o){a.push(Object(r.jsx)("div",{className:"grid-tile",onMouseDown:function(t){return e.mouseDownHandler(t,n,o)},onMouseOver:function(t){return e.mouseOverHandler(t,n,o)},onContextMenu:function(e){return e.preventDefault()},children:Object(r.jsx)(T,{displayRoadTileDescriptor:t.displayRoadTileDescriptors,type:i.get(n,o)})},"grid-tile".concat(n*s+o)))},c=0;c<s;c++)o(c)},c=0;c<n;c++)o(c);return Object(r.jsx)("div",{className:"grid-wrapper",children:a})}}]),i}(s.a.Component),j=function(){function e(){Object(d.a)(this,e),this.vehicles={},this.vehicles[f.UP]=null,this.vehicles[f.RIGHT]=null,this.vehicles[f.DOWN]=null,this.vehicles[f.LEFT]=null,this.waitTimersMillisec={},this.waitTimersMillisec[f.UP]=0,this.waitTimersMillisec[f.RIGHT]=0,this.waitTimersMillisec[f.DOWN]=0,this.waitTimersMillisec[f.LEFT]=0,this._dequeueOrder=[f.UP,f.RIGHT,f.DOWN,f.LEFT],this._clearTimer=0}return Object(v.a)(e,[{key:"enqueue",value:function(t,i){this.waitTimersMillisec[i]=e.WAIT_TIME_DURATION,this.vehicles[i]=t}},{key:"_dequeue",value:function(e){var t=this.vehicles[e];return this.vehicles[e]=null,t}},{key:"step",value:function(t){for(var i in this.waitTimersMillisec){var r=this.waitTimersMillisec[i];this.waitTimersMillisec[i]=Math.max(r-t,0)}if(this._clearTimer=Math.max(this._clearTimer-t,0),this._clearTimer>0)return null;for(var n=0;n<this._dequeueOrder.length;n++){var s=this._dequeueOrder.shift();if(this._dequeueOrder.push(s),!(this.waitTimersMillisec[s]>0)&&this.vehicles[s])return this._clearTimer=e.CLEAR_TIME_DURATION,this._dequeue(s)}return null}}],[{key:"CLEAR_TIME_DURATION",get:function(){return 1e3}},{key:"WAIT_TIME_DURATION",get:function(){return 1e3}}]),e}(),m=(i(24),i(7)),E=function(){function e(t,i,r,n,s,a,o){Object(d.a)(this,e),this.centerX=t,this.centerY=i,this.w=r,this.h=n,this.angleRad=s,this.xOffset=a,this.yOffset=o,this.defaultVertices=[{x:this.centerX-this.w/2+a,y:this.centerY-this.h/2+o},{x:this.centerX+this.w/2+a,y:this.centerY-this.h/2+o},{x:this.centerX+this.w/2+a,y:this.centerY+this.h/2+o},{x:this.centerX-this.w/2+a,y:this.centerY+this.h/2+o}],this.vertices=[{x:this.centerX-this.w/2+a,y:this.centerY-this.h/2+o},{x:this.centerX+this.w/2+a,y:this.centerY-this.h/2+o},{x:this.centerX+this.w/2+a,y:this.centerY+this.h/2+o},{x:this.centerX-this.w/2+a,y:this.centerY+this.h/2+o}],this.rotateToAngleRad(this.angleRad)}return Object(v.a)(e,[{key:"_rotatePointAroundCenter",value:function(e,t,i){var r=e.x-t.x,n=e.y-t.y,s=r*Math.cos(i)-n*Math.sin(i),a=r*Math.sin(i)+n*Math.cos(i);return{x:s+t.x,y:a+t.y}}},{key:"translate",value:function(e,t){this.centerX+=e,this.centerY+=t,this.vertices=this.vertices.map((function(i){return{x:i.x+e,y:i.y+t}})),this.defaultVertices=this.defaultVertices.map((function(i){return{x:i.x+e,y:i.y+t}}))}},{key:"rotateToAngleRad",value:function(e){var t=this.center;this.vertices=[this._rotatePointAroundCenter(this.defaultVertices[0],t,e),this._rotatePointAroundCenter(this.defaultVertices[1],t,e),this._rotatePointAroundCenter(this.defaultVertices[2],t,e),this._rotatePointAroundCenter(this.defaultVertices[3],t,e)],this.angleRad=e}},{key:"rotateDeg",value:function(e){this.angleRad=(this.angleRad+e*(Math.PI/180))%(2*Math.PI),this.rotateToAngleRad(this.angleRad)}},{key:"minX",get:function(){return Math.min.apply(Math,Object(m.a)(this.vertices.map((function(e){return e.x}))))}},{key:"maxX",get:function(){return Math.max.apply(Math,Object(m.a)(this.vertices.map((function(e){return e.x}))))}},{key:"minY",get:function(){return Math.min.apply(Math,Object(m.a)(this.vertices.map((function(e){return e.y}))))}},{key:"maxY",get:function(){return Math.max.apply(Math,Object(m.a)(this.vertices.map((function(e){return e.y}))))}},{key:"boundingWidth",get:function(){return this.maxX-this.minX}},{key:"boundingHeight",get:function(){return this.maxY-this.minY}},{key:"topLeft",get:function(){return{top:this.minY,left:this.minX}}},{key:"verticesAtOrigin",get:function(){var e=this;return this.vertices.map((function(t){return[t.x-e.minX,t.y-e.minY]}))}},{key:"center",get:function(){return{x:this.centerX,y:this.centerY}}}]),e}(),N=function(e){Object(u.a)(i,e);var t=Object(l.a)(i);function i(){return Object(d.a)(this,i),t.apply(this,arguments)}return Object(v.a)(i,[{key:"_hasSeparatingAxis",value:function(e,t){for(var i=0;i<4;i++)for(var r=e.vertices[(i+1)%4].y-e.vertices[i].y,n=e.vertices[i].x-e.vertices[(i+1)%4].x,s=0;s<4;s++){if((t.vertices[s].x-e.vertices[i].x)*r+(t.vertices[s].y-e.vertices[i].y)*n<=0)break;if(3===s)return!0}return!1}},{key:"collidesWith",value:function(e){return!this._hasSeparatingAxis(this,e)&&!this._hasSeparatingAxis(e,this)}}]),i}(E),_=function(e){Object(u.a)(i,e);var t=Object(l.a)(i);function i(){return Object(d.a)(this,i),t.apply(this,arguments)}return Object(v.a)(i,[{key:"render",value:function(){var e=this.props.rect;return Object(r.jsx)("div",{style:{position:"absolute",backgroundColor:this.props.backgroundColor,width:e.boundingWidth+"px",height:e.boundingHeight+"px",top:e.topLeft.top,left:e.topLeft.left,clipPath:this.polygonStr}})}},{key:"polygonStr",get:function(){var e=this.props.rect.verticesAtOrigin.map((function(e){return e.map((function(e){return e+"px"})).join(" ")})).join(", ");return"polygon(".concat(e,")")}}]),i}(s.a.Component),I=i(14),k=(i(32),function(){function e(){Object(d.a)(this,e),this.edges={}}return Object(v.a)(e,[{key:"_checkIsPositiveInteger",value:function(e,t){if(!Number.isInteger(e)||e<0)throw new TypeError("".concat(t," must be a positive integer."))}},{key:"addEdge",value:function(e,t){this._checkIsPositiveInteger(e,"source"),this._checkIsPositiveInteger(t,"target"),this.edges.hasOwnProperty(e)||(this.edges[e]=[]),this.edges.hasOwnProperty(t)||(this.edges[t]=[]),this.edges[e].includes(t)||this.edges[e].push(t)}},{key:"removeEdge",value:function(e,t){this._checkIsPositiveInteger(e,"source"),this._checkIsPositiveInteger(t,"target"),this.edges.hasOwnProperty(e)&&(this.edges[e]=this.edges[e].filter((function(e){return e!==t})),0===this.inDegree(e)&&0===this.outDegree(e)&&delete this.edges[e],0===this.inDegree(t)&&0===this.outDegree(t)&&delete this.edges[t])}},{key:"removeNode",value:function(e){if(this._checkIsPositiveInteger(e,"source"),this.edges.hasOwnProperty(e))for(var t in delete this.edges[e],this.edges){t=Number(t);var i=this.edges[t].indexOf(e);i>-1&&this.edges[t].splice(i,1),0===this.inDegree(t)&&0===this.outDegree(t)&&delete this.edges[t]}}},{key:"inDegree",value:function(e){this._checkIsPositiveInteger(e,"source");var t=0;return Object.values(this.edges).forEach((function(i){i.includes(e)&&t++})),t}},{key:"outDegree",value:function(e){return this._checkIsPositiveInteger(e,"source"),this.edges[e].length}},{key:"adjacent",value:function(e){return this._checkIsPositiveInteger(e,"source"),this.edges[e]}},{key:"alongPath",value:function(e){this._checkIsPositiveInteger(e,"source");var t=new Set,i=new Set,r=Object(m.a)(this.adjacent(e));for(i.add(e);r.length>0;){var n=r.pop();i.has(n)||(r.push.apply(r,Object(m.a)(this.adjacent(n))),t.add(n),i.add(n))}return t}},{key:"shortestPath",value:function(e,t){var i=this;this._checkIsPositiveInteger(e,"source"),this._checkIsPositiveInteger(t,"target");var r={},n={},s=this.nodes;s.forEach((function(e){r[e]=1/0,n[e]=null})),r[e]=0;for(var a=function(){for(var e=1/0,t=s[0],a=0;a<s.length;a++){var o=s[a];r[o]<e&&(t=o,e=r[o])}i.adjacent(t).forEach((function(e){var i=r[t]+1;i<r[e]&&(r[e]=i,n[e]=t)})),s=s.filter((function(e){return e!==t}))};s.length>0;)a();if(r[t]===1/0)throw new Error("No path from ".concat(e," to ").concat(t,"."));for(var o=[],c=t;null!==c;)o.unshift(c),c=n[c];return o}},{key:"serializeEdges",value:function(){var e=this,t=[],i=function(i){var r=Number(i);t.push.apply(t,Object(m.a)(e.edges[r].map((function(e){return{source:r,target:e}}))))};for(var r in this.edges)i(r);return t}},{key:"nodes",get:function(){return Object.keys(this.edges).map((function(e){return Number(e)}))}}]),e}()),P={ENTER:0,EXIT:1};Object.freeze(P);var x=function e(t,i,r,n){Object(d.a)(this,e),this.id=e.count++,this.row=t,this.col=i,this.direction=r,this.travelNodeType=n;var s=getComputedStyle(document.documentElement),a=s.getPropertyValue("--tile-width-raw"),o=s.getPropertyValue("--tile-height-raw"),c=i*a+.5*a,h=t*o+.5*o;this.x=c,this.y=h,this.direction===f.UP?(this.y-=o/3,this.travelNodeType===P.ENTER?this.x-=a/8:this.travelNodeType===P.EXIT&&(this.x+=a/8)):this.direction===f.RIGHT?(this.x+=a/3,this.travelNodeType===P.ENTER?this.y-=o/8:this.travelNodeType===P.EXIT&&(this.y+=o/8)):this.direction===f.DOWN?(this.y+=o/3,this.travelNodeType===P.ENTER?this.x+=a/8:this.travelNodeType===P.EXIT&&(this.x-=a/8)):this.direction===f.LEFT&&(this.x-=a/3,this.travelNodeType===P.ENTER?this.y+=o/8:this.travelNodeType===P.EXIT&&(this.y-=o/8))};x.count=0;var R=function(){function e(t,i,r){var n=this;Object(d.a)(this,e),this.row=t,this.col=i,this.nodes={},y(r).forEach((function(e){n.addTravelNodes(e)}))}return Object(v.a)(e,[{key:"addTravelNodes",value:function(e){this.nodes[e]={},this.nodes[e][P.EXIT]=new x(this.row,this.col,e,P.EXIT),this.nodes[e][P.ENTER]=new x(this.row,this.col,e,P.ENTER)}},{key:"removeTravelNodes",value:function(e){delete this.nodes[e]}},{key:"getSegmentDirections",value:function(){return Object.keys(this.nodes)}},{key:"getEnterNodes",value:function(){var e=this,t=[];return this.getSegmentDirections().forEach((function(i){t.push(e.nodes[i][P.ENTER])})),t}},{key:"getExitNodes",value:function(){var e=this,t=[];return this.getSegmentDirections().forEach((function(i){t.push(e.nodes[i][P.EXIT])})),t}},{key:"getNodesForSegment",value:function(e){return[this.nodes[e][P.EXIT],this.nodes[e][P.ENTER]]}}]),e}(),w=function(){function e(t,i,r){Object(d.a)(this,e),this.graph=t||new k,this.nodes=i||{},this.intersections=r||{}}return Object(v.a)(e,[{key:"hasNode",value:function(e){return Object.keys(this.nodes).includes(String(e))}},{key:"getNode",value:function(e){return this.nodes[e]}},{key:"getNodes",value:function(){return this.nodes}},{key:"getNewestNode",value:function(){if(0===Object.keys(this.nodes).length)return null;var e=Object.keys(this.nodes).reduce((function(e,t){return Number(e)>Number(t)?e:t}));return this.nodes[e]}},{key:"getRandomNodeAlongPath",value:function(e){var t=Array.from(this.graph.alongPath(e)),i=t[Math.floor(Math.random()*t.length)];return this.nodes[i]}},{key:"getEdges",value:function(){return this.graph.serializeEdges()}},{key:"getShortestPath",value:function(e,t){return this.graph.shortestPath(e,t)}},{key:"registerTravelIntersection",value:function(e,t,i,r){var n=new R(e,t,i);for(var s in this._intraconnectRoads(n),r){var a=r[s],o=a.coords[0],c=a.coords[1],u=this.intersections[[o,c]];u.addTravelNodes(g(s)),this._removeIntersectionIntraconnectedEdges(u)}for(var l in r){var d=r[l],v=d.coords[0],f=d.coords[1],p=this.intersections[[v,f]],y=n.getNodesForSegment(l),T=Object(h.a)(y,2),O=T[0],b=T[1],j=p.getNodesForSegment(g(l)),m=Object(h.a)(j,2),E=m[0],N=m[1];this._addEdge(O,N),this._addEdge(E,b)}this.intersections[[e,t]]=n}},{key:"unregisterTravelIntersection",value:function(e,t,i){var r=this.intersections[[e,t]];for(var n in i){var s=r.getNodesForSegment(n),a=Object(h.a)(s,2),o=a[0],c=a[1],u=i[n],l=Object(h.a)(u.coords,2),d=l[0],v=l[1],f=this.intersections[[d,v]],p=f.getNodesForSegment(g(n)),y=Object(h.a)(p,2),T=y[0],O=y[1];this._removeNode(o),this._removeNode(c),f.removeTravelNodes(g(n)),this._removeNode(T),this._removeNode(O),this._intraconnectRoads(f)}delete this.intersections[[e,t]]}},{key:"_addEdge",value:function(e,t){this.graph.addEdge(e.id,t.id),this.nodes[e.id]=e,this.nodes[t.id]=t}},{key:"_removeEdge",value:function(e,t){this.graph.removeEdge(e.id,t.id)}},{key:"_removeNode",value:function(e){this.graph.removeNode(e.id)}},{key:"_intraconnectRoads",value:function(e){var t=this,i=e.getSegmentDirections();if(1===i.length){var r=e.getNodesForSegment(i[0]),n=Object(h.a)(r,2),s=n[0],a=n[1];this._addEdge(a,s)}else e.getEnterNodes().forEach((function(i){e.getExitNodes().forEach((function(e){e.direction!==i.direction&&t._addEdge(i,e)}))}))}},{key:"_removeIntersectionIntraconnectedEdges",value:function(e){var t=this;e.getSegmentDirections().forEach((function(i){var r=e.getNodesForSegment(i),n=Object(h.a)(r,2),s=n[0],a=n[1];t._removeEdge(a,s)})),this._intraconnectRoads(e)}}]),e}(),D=function(e){Object(u.a)(i,e);var t=Object(l.a)(i);function i(){return Object(d.a)(this,i),t.apply(this,arguments)}return Object(v.a)(i,[{key:"render",value:function(){var e=this.props.exitNode,t=this.props.enterNode;return Object(r.jsxs)("div",{children:[Object(r.jsx)("p",{className:"node-label",style:{top:"".concat(e.y,"px"),left:"".concat(e.x,"px")},children:e.id}),Object(r.jsx)(I.Line,{x0:e.x,y0:e.y,x1:t.x,y1:t.y})]})}}]),i}(s.a.Component),M=function(e){Object(u.a)(i,e);var t=Object(l.a)(i);function i(){return Object(d.a)(this,i),t.apply(this,arguments)}return Object(v.a)(i,[{key:"render",value:function(){var e=this.props.travelGraph;return this.props.globalSettings.displayTravelEdges?Object(r.jsx)("div",{children:e.getEdges().map((function(t){var i=e.getNode(t.source),n=e.getNode(t.target);return Object(r.jsx)(D,{exitNode:i,enterNode:n},"travel-edge-".concat(i.id,"-").concat(n.id))}))}):Object(r.jsx)("div",{})}}]),i}(s.a.Component),A=function(e){Object(u.a)(i,e);var t=Object(l.a)(i);function i(e,r,n,s){var a;Object(d.a)(this,i),(a=t.call(this,r,n,8,4,0,0,0)).id=e,a.color=a.randomColor(),a.path=[],a.prevTargetId=s,a.speedPerSec=30;return a.frontCollider=new N(r,n,4,2,a.angleRad,6,0),a.waitingAtInsct=!1,a}return Object(v.a)(i,[{key:"randomColor",value:function(){var e,t,i=(e=0,t=359,Math.floor(Math.random()*(t-e+1))+e);return"hsl(".concat(i,", 100%, 75%)")}},{key:"setPath",value:function(e){this.path=e}},{key:"setRandomPath",value:function(e){var t=this._getRandomPath(e,this.prevTargetId);this.setPath(t)}},{key:"resetRandomPath",value:function(e){if(e.hasNode(this.path[0])){var t=this._getRandomPath(e,this.path[0]);this.setPath(t)}else{var i=this._getRandomPath(e,this.prevTargetId);this.prevTargetId=i.shift(),this.setPath(i)}}},{key:"_getRandomPath",value:function(e,t){var i=e.getRandomNodeAlongPath(t);return e.getShortestPath(t,i.id)}},{key:"_moveTowardsTarget",value:function(e,t){var i=this.centerX,r=this.centerY,n=t.x-i,s=t.y-r,a=Math.sqrt(Math.pow(n,2)+Math.pow(s,2)),o=Math.min(e,a),c=Math.atan2(s,n),h=o*Math.cos(c),u=o*Math.sin(c);return this.translate(h,u),this.rotateToAngleRad(c),this.frontCollider.translate(h,u),this.frontCollider.rotateToAngleRad(c),this.angleRad=c,e-o}},{key:"step",value:function(e,t,i,r){0===this.path.length&&this.setRandomPath(t);for(var n=t.getNode(this.path[0]),s=this.speedPerSec*(e/1e3);!this.waitingAtInsct&&s>0;)if(this.prevTargetId!==n.id&&(s=this._moveTowardsTarget(s,n)),this.centerX===n.x&&this.centerY===n.y){this.prevTargetId=parseInt(this.path.shift()),0===this.path.length&&this.setRandomPath(t);var a=t.getNode(this.prevTargetId);if(this._atInsct(i,a)){r(this,a);break}n=t.getNode(this.path[0])}}},{key:"_atInsct",value:function(e,t){var i=e.get(t.row,t.col);return y(i).length>=3&&t.travelNodeType===P.ENTER}}]),i}(E);function F(e){return Object(r.jsxs)("div",{onClick:function(t){return console.log(e.vehicle)},children:[Object(r.jsx)(_,{rect:e.vehicle,backgroundColor:e.vehicle.color}),e.globalSettings.displayVehicleColliders?Object(r.jsx)(_,{rect:e.vehicle.frontCollider,backgroundColor:"#f00"}):Object(r.jsx)("div",{})]})}var L=function(){function e(t,i){Object(d.a)(this,e),this.vehicles=t,this.inscts=i||{},this._addVehicleToInsct=this._addVehicleToInsct.bind(this)}return Object(v.a)(e,[{key:"addVehicle",value:function(t){var i=e.count++,r=t.x,n=t.y,s=new A(i,r,n,t.id);return this.vehicles.push(s),s}},{key:"_vehicleInCollision",value:function(e){for(var t in this.vehicles)if(this.vehicles[t]!==e&&e.frontCollider.collidesWith(this.vehicles[t]))return!0;return!1}},{key:"_addVehicleToInsct",value:function(e,t){var i=t.row,r=t.col,n="".concat(i,",").concat(r);this.inscts.hasOwnProperty(n)||(this.inscts[n]=new j),this.inscts[n].enqueue(e,t.direction),e.waitingAtInsct=!0}},{key:"step",value:function(e,t,i){var r=this;for(var n in this.inscts){var s=this.inscts[n].step(e);s&&(s.waitingAtInsct=!1)}this.vehicles.forEach((function(n){r._vehicleInCollision(n)||n.step(e,t,i,r._addVehicleToInsct)}))}},{key:"vehicleIn",value:function(e,t,i){var r=getComputedStyle(document.documentElement),n=Number(r.getPropertyValue("--tile-width-raw")),s=Number(r.getPropertyValue("--tile-height-raw")),a=n*i,o=s*t,c=a+n-1,h=o+s-1;return e.centerX>=a&&e.centerX<=c&&e.centerY>=o&&e.centerY<=h}},{key:"removeVehiclesNear",value:function(e,t,i){for(var r in this.removeVehiclesAt(e,t),i){var n=Object(h.a)(i[r].coords,2),s=n[0],a=n[1];this.removeVehiclesAt(s,a)}}},{key:"removeVehiclesAt",value:function(e,t){var i=this;this.vehicles=this.vehicles.filter((function(r){return!i.vehicleIn(r,e,t)}))}},{key:"rerandomizeAllVehiclePaths",value:function(e){this.vehicles.forEach((function(t){t.resetRandomPath(e)}))}}]),e}();function H(e){return Object(r.jsx)("div",{children:e.traffic.vehicles.map((function(t){return Object(r.jsx)(F,{globalSettings:e.globalSettings,vehicle:t},"vehicle-component".concat(t.id))}))})}function W(e){var t=Object(n.useState)(new O(e.rows,e.cols,null)),i=Object(h.a)(t,2),s=i[0],a=i[1],o=Object(n.useState)(new w(null,null,null)),c=Object(h.a)(o,2),u=c[0],l=c[1],d=Object(n.useState)(new L([],{})),v=Object(h.a)(d,2),f=v[0],g=v[1],p=Object(n.useState)(Date.now()),y=Object(h.a)(p,2),T=y[0],j=y[1];function m(){var t=new O(e.rows,e.cols,s.innerArray);a(t);var i=u.graph,r=u.nodes,n=u.intersections,o=new w(i,r,n);l(o);var c=new L(f.vehicles,f.inscts);g(c)}return Object(n.useEffect)((function(){var e=setInterval((function(){document.hidden?j(Date.now()):function(){var e=Date.now(),t=e-T;f.step(t,u,s);var i=new L(f.vehicles,f.inscts);g(i),j(e)}()}),16);return function(){return clearInterval(e)}})),Object(r.jsxs)("div",{children:[Object(r.jsx)(b,{globalSettings:e.globalSettings,roadTileMatrix:s,addRoad:function(e,t,i){if(s.addTile(e,t,i)){var r=s.get(e,t),n=s.getNeighbors(e,t);if(u.registerTravelIntersection(e,t,r,n),Math.floor(100*Math.random())<40){var a=u.getNewestNode();a&&f.addVehicle(a)}f.rerandomizeAllVehiclePaths(u),m()}},removeRoad:function(e,t){if(s.tileCanBeRemoved(e,t)){var i=s.getNeighbors(e,t);f.removeVehiclesNear(e,t,i),u.unregisterTravelIntersection(e,t,i),f.rerandomizeAllVehiclePaths(u),s.removeTile(e,t)&&m()}}}),Object(r.jsx)(M,{globalSettings:e.globalSettings,travelGraph:u}),Object(r.jsx)(H,{globalSettings:e.globalSettings,traffic:f})]})}function S(e){return Object(r.jsxs)("div",{children:[Object(r.jsx)("p",{children:"Debug Settings:"}),Object(r.jsxs)("form",{children:[Object(r.jsx)("input",{type:"checkbox",id:"road-tile-descriptors",name:"road-tile-descriptors",onChange:function(t){e.setDisplayRoadTileDescriptors(t.target.checked)}}),Object(r.jsx)("label",{htmlFor:"road-tile-descriptors",children:"Tile Descriptors"}),Object(r.jsx)("br",{}),Object(r.jsx)("input",{type:"checkbox",id:"travel-edges",name:"travel-edges",onChange:function(t){e.setDisplayTravelEdges(t.target.checked)}}),Object(r.jsx)("label",{htmlFor:"travel-edges",children:"Travel Edges"}),Object(r.jsx)("br",{}),Object(r.jsx)("input",{type:"checkbox",id:"vehicle-colliders",name:"vehicle-colliders",onChange:function(t){e.setDisplayVehicleColliders(t.target.checked)}}),Object(r.jsx)("label",{htmlFor:"vehicle-colliders",children:"Vehicle Colliders"})]})]})}L.count=0;var U=function(){var e=Object(n.useState)({displayRoadTileDescriptors:!1,displayTravelEdges:!1,displayVehicleColliders:!1}),t=Object(h.a)(e,2),i=t[0],s=t[1];return Object(r.jsxs)("div",{className:"App",children:[Object(r.jsx)(W,{globalSettings:i,rows:10,cols:25}),Object(r.jsx)(S,{setDisplayRoadTileDescriptors:function(e){s(Object(c.a)(Object(c.a)({},i),{},{displayRoadTileDescriptors:e}))},setDisplayTravelEdges:function(e){s(Object(c.a)(Object(c.a)({},i),{},{displayTravelEdges:e}))},setDisplayVehicleColliders:function(e){s(Object(c.a)(Object(c.a)({},i),{},{displayVehicleColliders:e}))}})]})},G=function(e){e&&e instanceof Function&&i.e(3).then(i.bind(null,34)).then((function(t){var i=t.getCLS,r=t.getFID,n=t.getFCP,s=t.getLCP,a=t.getTTFB;i(e),r(e),n(e),s(e),a(e)}))};o.a.render(Object(r.jsx)(s.a.StrictMode,{children:Object(r.jsx)(U,{})}),document.getElementById("root")),G()}},[[33,1,2]]]);
//# sourceMappingURL=main.6d1b215d.chunk.js.map